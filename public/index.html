<!-- index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Avalon Game Host</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="module" src="firebase-config.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container" id="main-menu">
    <h1>Avalon Game</h1>
    <div class="button-group">
      <button id="join-btn">Join a Game</button>
      <button id="admin-btn">Admin Panel</button>
    </div>
  </div>

  <!-- Join Game Form -->
  <div class="container hidden" id="join-container">
    <h2>Join Avalon Game</h2>
    <form id="join-form">
      <label for="join-username">Username:</label>
      <input type="text" id="join-username" required>
      <label for="join-game-id">Game ID:</label>
      <input type="text" id="join-game-id" required>
      <div class="button-row">
        <button type="submit">Join Game</button>
        <button id="back-join">Back</button>
      </div>
      <div class="error" id="join-error"></div>
    </form>
  </div>

  <!-- Admin Panel Form -->
  <div class="container hidden" id="admin-container">
    <h2>Admin Panel</h2>
    <form id="login-form">
      <input type="text" id="admin-name" placeholder="Admin Name" required>
      <input type="password" id="admin-password" placeholder="Password" required>

      <div class="button-row">
        <button type="submit">Login</button>
        <button id="back-admin">Back</button>
      </div>
      <div class="error" id="login-error"></div>
    </form>
  </div>

  <script>
    // Button handlers
    document.getElementById('join-btn').onclick = function () {
      document.getElementById('main-menu').classList.add('hidden');
      document.getElementById('join-container').classList.remove('hidden');
    };
    document.getElementById('admin-btn').onclick = function () {
      const adminName = localStorage.getItem('avalon_admin_name');
      if (adminName) {
        window.location.href = 'admin.html';
      } else {
        document.getElementById('main-menu').classList.add('hidden');
        document.getElementById('admin-container').classList.remove('hidden');
      }
    };
    document.getElementById('back-join').onclick = function () {
      document.getElementById('join-container').classList.add('hidden');
      document.getElementById('main-menu').classList.remove('hidden');
    };
    document.getElementById('back-admin').onclick = function () {
      document.getElementById('admin-container').classList.add('hidden');
      document.getElementById('main-menu').classList.remove('hidden');
    };

    document.getElementById('join-form').onsubmit = async function (e) {
      e.preventDefault();
      const username = document.getElementById('join-username').value.trim();
      const gameId = document.getElementById('join-game-id').value.trim();
      const joinError = document.getElementById('join-error');
      joinError.textContent = '';

      if (!username || !gameId) {
        joinError.textContent = "Please enter both username and Game ID.";
        return;
      }

      try {
        // Store username and gameId for lobby.html
        localStorage.setItem('avalon_game_id', gameId);
        // Redirect to lobby.html
        window.location.href = `lobby.html?gameId=${encodeURIComponent(gameId)}`;
      } catch (err) {
        joinError.textContent = err.message;
      }
    };


    // Admin Panel Form Handler
    document.getElementById('login-form').onsubmit = async function (e) {
      e.preventDefault();
      const loginError = document.getElementById('login-error');
      loginError.textContent = '';
      const name = document.getElementById('admin-name').value.trim();
      const password = document.getElementById('admin-password').value;
      if (!name || !password) {
        loginError.textContent = "Please enter both name and password.";
        return;
      }
      localStorage.setItem('avalon_admin_name', name);
      window.location.href = 'admin.html';
    }
  </script>
</body>

</html>